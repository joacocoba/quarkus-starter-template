# üè¶ Servicio de Transacciones - Plantilla Quarkus

[![Quarkus](https://img.shields.io/badge/Quarkus-3.15.1-blue.svg)](https://quarkus.io/)
[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://openjdk.java.net/)
[![Maven](https://img.shields.io/badge/Maven-3.9+-green.svg)](https://maven.apache.org/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Una plantilla de microservicio lista para producci√≥n construida con **Quarkus** y **Java 21**, implementando **Arquitectura Hexagonal** para el manejo de transacciones financieras.

## üìã Tabla de Contenidos

- [üöÄ Caracter√≠sticas](#-caracter√≠sticas)
- [üèóÔ∏è Arquitectura](#Ô∏è-arquitectura)
- [‚ö° Inicio R√°pido](#-inicio-r√°pido)
- [üõ†Ô∏è Configuraci√≥n del Entorno](#Ô∏è-configuraci√≥n-del-entorno)
- [üìä API Endpoints](#-api-endpoints)
- [üß™ Pruebas](#-pruebas)
- [üìù Scripts Disponibles](#-scripts-disponibles)
- [üîß Git Hooks](#-git-hooks)
- [üåê Configuraci√≥n de GitHub](#-configuraci√≥n-de-github)
- [üìö Documentaci√≥n](#-documentaci√≥n)
- [üê≥ Docker](#-docker)
- [üîç Monitoreo](#-monitoreo)

## üöÄ Caracter√≠sticas

### üèóÔ∏è Arquitectura y Dise√±o
- **Arquitectura Hexagonal** (Puertos y Adaptadores)
- **Separaci√≥n limpia de responsabilidades** (Dominio, Aplicaci√≥n, Infraestructura)
- **Inyecci√≥n de dependencias** con CDI
- **Patr√≥n Repository** para acceso a datos
- **Manejo centralizado de errores**

### üîß Stack Tecnol√≥gico
- **Quarkus 3.15.1** - Framework reactivo supers√≥nico
- **Java 21** - √öltima versi√≥n LTS con caracter√≠sticas modernas
- **JAX-RS** - API REST con soporte JSON (Jackson)
- **Bean Validation** - Validaci√≥n comprehensiva de datos
- **OpenAPI/Swagger** - Documentaci√≥n autom√°tica de API
- **Health Checks & Metrics** - Monitoreo y observabilidad

### üìä Calidad de C√≥digo
- **Spotless** - Formateo consistente de c√≥digo
- **Checkstyle** - Estilo de c√≥digo (Google Style Guide)
- **Maven Enforcer** - Gesti√≥n de dependencias
- **JUnit 5 + Mockito + AssertJ** - Suite completa de pruebas

### üéØ Funcionalidades del Negocio
- **Gesti√≥n de transacciones** entre cuentas
- **Validaci√≥n de n√∫meros de cuenta**
- **Soporte multicurrency**
- **API RESTful** con versionado (`/api/v1`)
- **Repositorio en memoria** (f√°cil migraci√≥n a base de datos)

## üèóÔ∏è Arquitectura

```
src/main/java/com/example/transactions/
‚îú‚îÄ‚îÄ üìÅ application/           # Capa de Aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ mappers/             # Mapeo entre capas
‚îÇ   ‚îú‚îÄ‚îÄ services/            # L√≥gica de aplicaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ usecases/            # Casos de uso del negocio
‚îú‚îÄ‚îÄ üìÅ domain/               # Capa de Dominio
‚îÇ   ‚îú‚îÄ‚îÄ entities/            # Entidades del dominio
‚îÇ   ‚îú‚îÄ‚îÄ exceptions/          # Excepciones del negocio
‚îÇ   ‚îú‚îÄ‚îÄ ports/               # Puertos (interfaces)
‚îÇ   ‚îî‚îÄ‚îÄ valueobjects/        # Objetos de valor
‚îî‚îÄ‚îÄ üìÅ infrastructure/       # Capa de Infraestructura
    ‚îú‚îÄ‚îÄ adapters/            # Adaptadores REST
    ‚îú‚îÄ‚îÄ config/              # Configuraciones
    ‚îî‚îÄ‚îÄ repositories/        # Implementaciones de repositorios
```

### Principios Arquitect√≥nicos
- **Inversi√≥n de Dependencias**: Las capas externas dependen de las internas
- **Separaci√≥n de Responsabilidades**: Cada capa tiene una responsabilidad clara
- **Testabilidad**: Arquitectura que facilita las pruebas unitarias
- **Flexibilidad**: F√°cil intercambio de implementaciones

## ‚ö° Inicio R√°pido

### Prerrequisitos
- **Java 21+** (recomendado: Temurin u OpenJDK)
- **Maven 3.9+** (incluido Maven Wrapper)
- **Git** para control de versiones

### üåê Configuraci√≥n de Puertos (CENTRALIZADA)

El proyecto utiliza una configuraci√≥n centralizada de puertos que se puede controlar mediante variables de entorno:

```bash
# Puerto por defecto (todos los perfiles): 8080
# Cambiar puerto para desarrollo:
export DEV_PORT=8080
./mvnw quarkus:dev

# Cambiar puerto para producci√≥n:
export PORT=9090
java -jar target/quarkus-app/quarkus-run.jar

# Cambiar puerto para tests (normalmente autom√°tico = 0):
export TEST_PORT=8082
./mvnw test
```

### Configuraci√≥n por Perfil
- **Desarrollo** (`%dev`): Puerto `${DEV_PORT:8080}` (default: 8080)
- **Producci√≥n** (`%prod`): Puerto `${PORT:8080}` (default: 8080)
- **Test** (`%test`): Puerto `${TEST_PORT:0}` (default: random)

### Instalaci√≥n Autom√°tica

```bash
# 1. Clonar el repositorio
git clone https://github.com/joacocoba/transactions-service.git
cd transactions-service

# 2. Configurar entorno de desarrollo (instala Java 21 si es necesario)
./scripts/setup-dev.sh

# 3. Ejecutar la aplicaci√≥n (puerto 8080 por defecto)
./mvnw quarkus:dev
```

### Verificaci√≥n de la Instalaci√≥n

```bash
# Verificar que el servicio est√° funcionando
curl http://localhost:8080/q/health/ready

# Probar el API
curl -X POST http://localhost:8080/api/v1/transactions \
  -H "Content-Type: application/json" \
  -d '{"amount": 100.50, "currency": "USD", "originAccountNumber": "ACC-12345", "destinationAccountNumber": "ACC-67890"}'
```

## üõ†Ô∏è Configuraci√≥n del Entorno

### Usando SDKMAN (Recomendado)

```bash
# Instalar SDKMAN
curl -s "https://get.sdkman.io" | bash
source ~/.sdkman/bin/sdkman-init.sh

# Instalar Java 21
sdk install java 21.0.4-tem
sdk use java 21.0.4-tem

# Verificar instalaci√≥n
java -version
```

### Configuraci√≥n Manual

1. **Descargar Java 21** desde [Adoptium](https://adoptium.net/)
2. **Configurar JAVA_HOME** en tu sistema
3. **Verificar Maven** viene incluido (Maven Wrapper)

### Variables de Entorno

```bash
export JAVA_HOME=/path/to/java21
export MAVEN_OPTS="-Xmx1024m -XX:MaxPermSize=256m"
```

## üìä API Endpoints

### Transacciones

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/api/v1/transactions` | Crear nueva transacci√≥n |
| `GET` | `/api/v1/transactions/{id}` | Obtener transacci√≥n por ID |
| `GET` | `/api/v1/transactions` | Listar todas las transacciones |

### Monitoreo y Salud

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `GET` | `/q/health/ready` | Verificar si el servicio est√° listo |
| `GET` | `/q/health/live` | Verificar si el servicio est√° vivo |
| `GET` | `/q/metrics` | M√©tricas de la aplicaci√≥n |
| `GET` | `/q/swagger-ui` | Documentaci√≥n interactiva de la API |

### Ejemplo de Uso

```bash
# Crear transacci√≥n
curl -X POST http://localhost:8080/api/v1/transactions \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 250.75,
    "currency": "USD", 
    "originAccountNumber": "ACC-123456",
    "destinationAccountNumber": "ACC-789012"
  }'

# Respuesta esperada
{
  "id": "uuid-generated",
  "amount": 250.75,
  "currency": "USD",
  "originAccountNumber": "ACC-123456",
  "destinationAccountNumber": "ACC-789012",
  "status": "COMPLETED",
  "timestamp": "2025-09-24T10:30:00Z"
}
```

## üß™ Pruebas

### Ejecutar Todas las Pruebas

```bash
# Pruebas unitarias
./mvnw test

# Pruebas de integraci√≥n  
./mvnw verify

# Pruebas con reporte de cobertura
./mvnw test jacoco:report
```

### Tipos de Pruebas

- **Unitarias**: Pruebas de l√≥gica de dominio y aplicaci√≥n
- **Integraci√≥n**: Pruebas de API endpoints
- **Contratos**: Validaci√≥n de esquemas JSON
- **Arquitectura**: Verificaci√≥n de principios arquitect√≥nicos

### Ejecutar Pruebas Espec√≠ficas

```bash
# Solo pruebas de dominio
./mvnw test -Dtest="*DomainTest"

# Solo pruebas de API
./mvnw test -Dtest="*RestTest"

# Prueba espec√≠fica
./mvnw test -Dtest="TransactionServiceTest#shouldCreateTransaction"
```

## üìù Scripts Disponibles

Todos los scripts est√°n ubicados en el directorio `scripts/` y est√°n completamente documentados:

### `setup-dev.sh`
```bash
./scripts/setup-dev.sh
```
- üîß **Configuraci√≥n autom√°tica del entorno de desarrollo**
- ‚òï **Detecci√≥n e instalaci√≥n de Java 21 via SDKMAN**
- üì¶ **Verificaci√≥n de dependencias**
- üéØ **Compilaci√≥n y validaci√≥n inicial del proyecto**

### `test-api.sh`
```bash
./scripts/test-api.sh
```
- üß™ **Pruebas automatizadas de la API**
- üîç **Verificaci√≥n de endpoints principales**
- üìä **Health checks y validaci√≥n de respuestas**
- üéØ **Casos de prueba de transacciones**

### `java-env.sh`
```bash
source ./scripts/java-env.sh
```
- üåê **Gesti√≥n del entorno Java**
- üìã **Configuraci√≥n autom√°tica desde .sdkmanrc**
- ‚úÖ **Verificaci√≥n de versiones**
- üîß **Activaci√≥n de herramientas de desarrollo**

### `git-hooks.sh`
```bash
./scripts/git-hooks.sh [comando]
```
- üé£ **Gesti√≥n completa de Git hooks**
- Ver secci√≥n [Git Hooks](#-git-hooks) para detalles

## üîß Git Hooks

El proyecto incluye un sistema completo de Git hooks para mantener la calidad del c√≥digo:

### Comandos Disponibles

```bash
# Verificar estado del hook
./scripts/git-hooks.sh status

# Probar el hook manualmente  
./scripts/git-hooks.sh test

# Deshabilitar temporalmente
./scripts/git-hooks.sh disable

# Rehabilitar 
./scripts/git-hooks.sh enable

# Ver ayuda completa
./scripts/git-hooks.sh
```

### ¬øQu√© hace el Pre-commit Hook?

El hook de pre-commit ejecuta autom√°ticamente antes de cada commit:

1. **‚úÖ Verificaci√≥n de Compilaci√≥n**
   ```bash
   ./mvnw compile -q -DskipTests
   ```

2. **üß™ Ejecuci√≥n de Pruebas**
   ```bash
   ./mvnw test -q
   ```

3. **üé® Validaci√≥n de Formato de C√≥digo**
   ```bash
   ./mvnw spotless:check -q
   ```

4. **üîç Detecci√≥n de Problemas Comunes**
   - TODOs sin resolver
   - Declaraciones de debug (System.out, printStackTrace)
   - Archivos grandes (>1MB)
   - Archivos binarios no deseados

### Configuraci√≥n del Hook

El hook se instala autom√°ticamente cuando ejecutas `setup-dev.sh`. Para instalarlo manualmente:

```bash
# El hook ya existe en .git/hooks/pre-commit
# Solo necesitas verificar que est√© activo
./scripts/git-hooks.sh status
```

### Bypass Temporal (Solo en Emergencias)

```bash
# Commit omitiendo el hook (NO recomendado)
git commit --no-verify -m "Mensaje de commit"

# Mejor opci√≥n: deshabilitar temporalmente
./scripts/git-hooks.sh disable
git commit -m "Mensaje de commit"
./scripts/git-hooks.sh enable
```

## üåê Configuraci√≥n de GitHub

El proyecto incluye configuraci√≥n completa para GitHub. Ver detalles en `GITHUB_SETUP.md` traducido al espa√±ol:

### Pasos R√°pidos para GitHub

1. **Crear Repositorio en GitHub**
   - Nombre: `transactions-service` o como prefieras
   - **NO** inicializar con README (ya tenemos uno)

2. **Agregar Remote y Push**
   ```bash
   git remote add origin https://github.com/tu-usuario/transactions-service.git
   git branch -M main
   git push -u origin main
   ```

3. **Crear Release (Opcional)**
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

### Caracter√≠sticas para GitHub

- ‚úÖ **README completo** con badges y documentaci√≥n
- ‚úÖ **Issues templates** para bugs y features
- ‚úÖ **Pull Request template** 
- ‚úÖ **GitHub Actions** preparado (CI/CD)
- ‚úÖ **Dependabot** configurado
- ‚úÖ **Security** pol√≠ticas incluidas

Ver `GITHUB_SETUP.md` para la gu√≠a completa en espa√±ol.

## üìö Documentaci√≥n

### Documentaci√≥n de la API
- **Swagger UI**: http://localhost:8080/q/swagger-ui/
- **OpenAPI JSON**: http://localhost:8080/q/openapi

### Estructura de Documentaci√≥n

```
üìö Documentaci√≥n
‚îú‚îÄ‚îÄ README.md              # Este archivo - Gu√≠a principal
‚îú‚îÄ‚îÄ scripts/README.md      # Documentaci√≥n de scripts
‚îú‚îÄ‚îÄ GITHUB_SETUP.md       # Gu√≠a de configuraci√≥n GitHub
‚îú‚îÄ‚îÄ docs/                 # Documentaci√≥n adicional
‚îÇ   ‚îú‚îÄ‚îÄ architecture.md   # Decisiones arquitect√≥nicas
‚îÇ   ‚îú‚îÄ‚îÄ deployment.md     # Gu√≠a de despliegue
‚îÇ   ‚îî‚îÄ‚îÄ troubleshooting.md # Soluci√≥n de problemas
‚îî‚îÄ‚îÄ API Documentation     # Swagger/OpenAPI autom√°tico
```

### Generar Documentaci√≥n

```bash
# Generar documentaci√≥n de API
./mvnw compile

# La documentaci√≥n estar√° disponible en:
# http://localhost:8080/q/swagger-ui/
```

## üê≥ Docker

### Construcci√≥n de Imagen

```bash
# Imagen nativa (m√°s r√°pida, menor tama√±o)
./mvnw package -Pnative -Dquarkus.native.container-build=true
docker build -f src/main/docker/Dockerfile.native -t transactions-service:native .

# Imagen JVM (m√°s r√°pida de construir)
./mvnw package
docker build -f src/main/docker/Dockerfile.jvm -t transactions-service:jvm .
```

### Ejecutar con Docker

```bash
# Imagen nativa
docker run -i --rm -p 8080:8080 transactions-service:native

# Imagen JVM  
docker run -i --rm -p 8080:8080 transactions-service:jvm
```

### Docker Compose (Desarrollo)

```yaml
version: '3.8'
services:
  transactions-service:
    build: .
    ports:
      - "8080:8080"
    environment:
      - QUARKUS_PROFILE=dev
```

## üîç Monitoreo

### Health Checks

```bash
# Verificar que el servicio est√° listo para recibir tr√°fico
curl http://localhost:8080/q/health/ready

# Verificar que el servicio est√° funcionando
curl http://localhost:8080/q/health/live
```

### M√©tricas

```bash
# M√©tricas de la aplicaci√≥n (formato Prometheus)
curl http://localhost:8080/q/metrics

# M√©tricas espec√≠ficas de la aplicaci√≥n
curl http://localhost:8080/q/metrics/application
```

### Logs

```bash
# Logs en modo desarrollo (m√°s verbosos)
./mvnw quarkus:dev

# Logs en producci√≥n (configurables via application.properties)
java -jar target/quarkus-app/quarkus-run.jar
```

## üöÄ Modo de Desarrollo

```bash
# Iniciar en modo desarrollo (hot reload)
./mvnw quarkus:dev

# El servicio estar√° disponible en:
# - API: http://localhost:8080
# - Swagger UI: http://localhost:8080/q/swagger-ui/
# - Health: http://localhost:8080/q/health
```

### Caracter√≠sticas del Modo Dev
- **Hot Reload**: Cambios autom√°ticos sin reiniciar
- **Dev UI**: Interfaz de desarrollo en http://localhost:8080/q/dev/
- **Test Continuous**: Pruebas autom√°ticas en background
- **Live Coding**: Desarrollo en tiempo real

## ü§ù Contribuci√≥n

1. **Fork** el repositorio
2. **Crear rama** para tu feature (`git checkout -b feature/nueva-caracteristica`)
3. **Commit** tus cambios (`git commit -m 'feat: agregar nueva caracter√≠stica'`)
4. **Push** a la rama (`git push origin feature/nueva-caracteristica`)
5. **Crear Pull Request**

### Est√°ndares de C√≥digo
- **Seguir Google Java Style Guide**
- **Usar Conventional Commits** para mensajes
- **Escribir pruebas** para nuevo c√≥digo
- **Mantener cobertura** > 80%

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para detalles.

## üë• Autores

- **Tu Nombre** - *Trabajo inicial* - [@tu-usuario](https://github.com/tu-usuario)

## üôè Agradecimientos

- **Quarkus Team** por el excelente framework
- **Red Hat** por el ecosistema de herramientas
- **Comunidad Java** por las mejores pr√°cticas

---

‚≠ê **¬°Si te gust√≥ este proyecto, dale una estrella!** ‚≠ê
